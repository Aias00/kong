## Kong







### Fixes
#### CLI Command

- Fixed an issue where the `pg_timeout` was overridden to `60s` even if `--db-timeout`
was not explicitly passed in CLI arguments.
 [#9023](https://github.com/Kong/kong-ee/issues/9023)
 [KAG-4416](https://konghq.atlassian.net/browse/KAG-4416)
#### Plugin

- Improve error handling in AI plugins.
 [#9124](https://github.com/Kong/kong-ee/issues/9124)
 [KAG-4311](https://konghq.atlassian.net/browse/KAG-4311)

- **ACME**: Fixed migration of redis configuration.
 [#9044](https://github.com/Kong/kong-ee/issues/9044)
 [KAG-4419](https://konghq.atlassian.net/browse/KAG-4419)

- **Response-RateLimiting**: Fixed migration of redis configuration.
 [#9044](https://github.com/Kong/kong-ee/issues/9044)
 [KAG-4419](https://konghq.atlassian.net/browse/KAG-4419)

- **Rate-Limiting**: Fixed migration of redis configuration.
 [#9044](https://github.com/Kong/kong-ee/issues/9044)
 [KAG-4419](https://konghq.atlassian.net/browse/KAG-4419)
## Kong-Enterprise


### Performance
#### Performance

- Speeded up tracing mechanism.
 [#8704](https://github.com/Kong/kong-ee/issues/8704)
 [KAG-3653](https://konghq.atlassian.net/browse/KAG-3653)

### Breaking Changes
#### Core

- "**Hashicorp Vault**: Starting from this version, a string fully made of spaces cannot be specified as the `role_id` or `secret_id` value in the Hashicorp Vault entity with Approle authentication method.
"**Hashicorp Vault**: Starting from this version, at least one of `secret_id` and `secret_id_file` must be specified in the Hashicorp Vault entity with Approle authentication method.
 [#8527](https://github.com/Kong/kong-ee/issues/8527)
 [KAG-3575](https://konghq.atlassian.net/browse/KAG-3575) [KAG-3580](https://konghq.atlassian.net/browse/KAG-3580)

- Removed the Granular Tracing feature, and configurations like `tracing = on` are not available any longer. You should now use [OpenTelemetry Instrumentation](https://docs.konghq.com/gateway/latest/production/tracing/) instead.
 [#8669](https://github.com/Kong/kong-ee/issues/8669)
 [KAG-2713](https://konghq.atlassian.net/browse/KAG-2713)


### Dependencies
#### Core

- Updated submodule kong-openid-connect to 2.7.1
 [#8424](https://github.com/Kong/kong-ee/issues/8424)
 [FTI-5400](https://konghq.atlassian.net/browse/FTI-5400)
#### Default

- Updated `kong-lua-resty-kafka` to `0.18`.
 [#8387](https://github.com/Kong/kong-ee/issues/8387)
 [FTI-5751](https://konghq.atlassian.net/browse/FTI-5751)

- Updated `lua-resty-luasocket` to `1.1.2` for fixing [luasocket#427](https://github.com/lunarmodules/luasocket/issues/427).
 [#8565](https://github.com/Kong/kong-ee/issues/8565)
 [FTI-5835](https://konghq.atlassian.net/browse/FTI-5835)

- Updated lua-resty-mail to 1.1.0
 [#8114](https://github.com/Kong/kong-ee/issues/8114)


- Updated OpenSSL FIPS-provider to 3.0.9
 [#8896](https://github.com/Kong/kong-ee/issues/8896)
 [CVE-2023](https://konghq.atlassian.net/browse/CVE-2023) [CVE-2022](https://konghq.atlassian.net/browse/CVE-2022) [KAG-4337](https://konghq.atlassian.net/browse/KAG-4337)

- Updated libpasswdqc to 2.0.3
 [#8165](https://github.com/Kong/kong-ee/issues/8165)
 [BIP-0039](https://konghq.atlassian.net/browse/BIP-0039)

- Updated lua-resty-cookie to 0.2.0
 [#8189](https://github.com/Kong/kong-ee/issues/8189)

- Updated lua-resty-passwdqc to 2.0
 [#8165](https://github.com/Kong/kong-ee/issues/8165)
 [BIP-0039](https://konghq.atlassian.net/browse/BIP-0039)

- Updated xmlua to 1.2.1
 [#8115](https://github.com/Kong/kong-ee/issues/8115)


- Updated libxml2 to 2.12.6
 [#8894](https://github.com/Kong/kong-ee/issues/8894)
 [KAG-4335](https://konghq.atlassian.net/browse/KAG-4335)

- Updated libxslt to 1.1.39
 [#8072](https://github.com/Kong/kong-ee/issues/8072)

- Updated msgpack-c to 6.0.1
 [#8895](https://github.com/Kong/kong-ee/issues/8895)
 [KAG-4336](https://konghq.atlassian.net/browse/KAG-4336)

- Remove lua-resty-openssl-aux-module dependency
 [#8963](https://github.com/Kong/kong-ee/issues/8963)
 [KAG-3791](https://konghq.atlassian.net/browse/KAG-3791)

### Features
#### Core

- **Analytics**: Add `latencies.receive_ms` and `websocket` fields
 [#8436](https://github.com/Kong/kong-ee/issues/8436)
 [KAG-3798](https://konghq.atlassian.net/browse/KAG-3798)

- **Analytics**: `latencies.kong_gateway_ms` no longer includes receive time/latency
 [#8436](https://github.com/Kong/kong-ee/issues/8436)
 [KAG-3798](https://konghq.atlassian.net/browse/KAG-3798)

- **Analytics**: Add `sse` boolean field to payload, which is set to `true` for Server-Sent Event requests/responses.
 [#8588](https://github.com/Kong/kong-ee/issues/8588)
 [KAG-4106](https://konghq.atlassian.net/browse/KAG-4106)
#### Plugin

- Introduced the new **AI Rate Limiting Advanced** plugin that allow to implement a rate limit by AI provider.
 [#8712](https://github.com/Kong/kong-ee/issues/8712)
 [KAG-3759](https://konghq.atlassian.net/browse/KAG-3759)

- **AI Azure Content Safety**: Adds a new plugin that allows the Kong administrator to enforce
that all AI-Proxy requests must be introspected with the Azure Content Safety service.

The plugin enables configurable thresholds for the different moderation categories,
and reports audit results into the Kong log serializer for reporting purposes.
 [#8697](https://github.com/Kong/kong-ee/issues/8697)
 [KAG-4124](https://konghq.atlassian.net/browse/KAG-4124) [KAG-4140](https://konghq.atlassian.net/browse/KAG-4140)

- Added support for Managed Identity authentication when using the
Azure provider with AI Proxy.
 [#8880](https://github.com/Kong/kong-ee/issues/8880)
 [KAG-4125](https://konghq.atlassian.net/browse/KAG-4125) [KAG-4124](https://konghq.atlassian.net/browse/KAG-4124) [KAG-4317](https://konghq.atlassian.net/browse/KAG-4317)

- ** Application Registration: ** Added support access the service using consumer credential authentication. To get this functionality, you can enable `enable_proxy_with_consumer_credential`(default is `false`).
 [#8556](https://github.com/Kong/kong-ee/issues/8556)
 [FTI-5789](https://konghq.atlassian.net/browse/FTI-5789)

- **OpenID Connect:** Added support for DPoP (Demonstrating Proof-of-Possession) tokens validation. The feature is available by enabling `proof_of_possession_dpop`
 [#8482](https://github.com/Kong/kong-ee/issues/8482)
 [KAG-3978](https://konghq.atlassian.net/browse/KAG-3978) [KAG-2893](https://konghq.atlassian.net/browse/KAG-2893)

- **graphql-proxy-cache-advanced:** Addded redis strategy support and `bypass_on_err` config for `graphql-proxy-cache-advanced` plugin.
 [#8760](https://github.com/Kong/kong-ee/issues/8760)
 [KAG-1868](https://konghq.atlassian.net/browse/KAG-1868)

- **JWT-Signer:** supports basic auth and mtls auth to external jwks services
 [#8292](https://github.com/Kong/kong-ee/issues/8292)
 [FTI-5400](https://konghq.atlassian.net/browse/FTI-5400)

- **JWT-Signer:** The plugin now supports periodically rotating the jwks. For example, to autmatically rotate `access_token_jwks_uri`, you can set the config `access_token_jwks_uri_rotate_period`
 [#8466](https://github.com/Kong/kong-ee/issues/8466)
 [FTI-5400](https://konghq.atlassian.net/browse/FTI-5400)

- **JWT-Signer:** The plugin now supports adding the original JWT(s) to the upstream request header by specifying the names of the upstream request header with `original_access_token_upstream_header` and `original_channel_token_upstream_header`.
And `access_token_upstream_header`, `channel_token_upstream_header`, `original_access_token_upstream_header`, and `original_channel_token_upstream_header` should not have the same value.
 [#8628](https://github.com/Kong/kong-ee/issues/8628)
 [KAG-4117](https://konghq.atlassian.net/browse/KAG-4117)

- Support pseudo json value in add_claims and set_claims for JWT-Signer. We can achieve the goal of passing multiple values to a key by passing a JSON string as the value. And add add_access_token_claims, set_access_token_claims, add_channel_token_claims, set_channel_token_claims for individually adding claims to access tokens and channel tokens. Additionally, add remove_access_token_claims and remove_channel_token_claims to support the removal of claims.
 [#8396](https://github.com/Kong/kong-ee/issues/8396)
 [KAG-3890](https://konghq.atlassian.net/browse/KAG-3890)

- **Mocking**: Add the `custom_base_path` field to specifiy a custom base path. It will be used with the `deck file namespace` feature
 [#8209](https://github.com/Kong/kong-ee/issues/8209)
 [KAG-4073](https://konghq.atlassian.net/browse/KAG-4073)

- **mtls-auth**: Add `default_consumer` option that allows a default consumer to be used when the client certificate is valid but does not match any existing consumers.
 [#8389](https://github.com/Kong/kong-ee/issues/8389)
 [KAG-3824](https://konghq.atlassian.net/browse/KAG-3824)

- **OAS-Validation**: Add a new field `api_spec_encoded` to indicate whether the `api_spec` is URI-Encoded.
 [#8368](https://github.com/Kong/kong-ee/issues/8368)
 [FTI-5797](https://konghq.atlassian.net/browse/FTI-5797)

- **OAS-Validation**: Add the `custom_base_path` field to specifiy a custom base path. It will be used with the `deck file namespace` feature
 [#8209](https://github.com/Kong/kong-ee/issues/8209)
 [KAG-4073](https://konghq.atlassian.net/browse/KAG-4073)

- **OAS-Validation**: Supported OpenAPI Specification v3.1.0. The plugin now switches to a new JSONSchema validator when the specification version is v3.1.0.
 [#7833](https://github.com/Kong/kong-ee/issues/7833)
 [KAG-4073](https://konghq.atlassian.net/browse/KAG-4073) [FTI-5596](https://konghq.atlassian.net/browse/FTI-5596)

- **OpenID Connect**: Add support for JWT Secured Authorization Requests (JAR) on Authorization and Pushed Authorization (PAR) endpoints, see: `config.require_signed_request_object`
 [#8751](https://github.com/Kong/kong-ee/issues/8751)
 [KAG-3295](https://konghq.atlassian.net/browse/KAG-3295) [KAG-3293](https://konghq.atlassian.net/browse/KAG-3293) [KAG-3296](https://konghq.atlassian.net/browse/KAG-3296)

- **OpenID Connect**: Add support for JARM response modes: `query.jwt`, `form_post.jwt`, `fragment.jwt`, `jwt`
 [#8701](https://github.com/Kong/kong-ee/issues/8701)
 [KAG-3837](https://konghq.atlassian.net/browse/KAG-3837) [KAG-3904](https://konghq.atlassian.net/browse/KAG-3904)
#### Admin API

- Add LHS brackets filtering to search fields
 [#8717](https://github.com/Kong/kong-ee/issues/8717)
 [KAG-3936](https://konghq.atlassian.net/browse/KAG-3936)

- **Audit Log:** Add request_timestamp to audit_objects.
 [#8716](https://github.com/Kong/kong-ee/issues/8716)
 [KAG-3936](https://konghq.atlassian.net/browse/KAG-3936)

- **Audit Log**: Add before / after aliases for LHS Brackets filters.
 [#8846](https://github.com/Kong/kong-ee/issues/8846)
 [KAG-3936](https://konghq.atlassian.net/browse/KAG-3936)

- **Audit Log:** Allow audit_requests and audit_objects to be filtered by request_timestamp.
 [#8716](https://github.com/Kong/kong-ee/issues/8716)
 [KAG-3936](https://konghq.atlassian.net/browse/KAG-3936)

- **Audit Log:** change default ordering of audit_requests to sorted by request_timestamp descending
 [#8711](https://github.com/Kong/kong-ee/issues/8711)
 [KAG-3936](https://konghq.atlassian.net/browse/KAG-3936)
#### Default

- When authenticating Kong Manager with IDPs (e.g., OIDC, LDAP), the source of an RBAC role will be  stored in its `role_source` field, which enables the existing roles with a source of `idp` to be  removed upon new logins after IDP role mapping has changed. This also allows users to change a role's  source between `local` and `idp`.
 [#8187](https://github.com/Kong/kong-ee/issues/8187)
 [KAG-3664](https://konghq.atlassian.net/browse/KAG-3664)

### Fixes
#### CLI Command

- Fixed a bug that caused the `kong` command line tool to ignore the `lua_ssl_trusted_certificate` configuration option.
 [#8380](https://github.com/Kong/kong-ee/issues/8380)
 [FTI-5724](https://konghq.atlassian.net/browse/FTI-5724)
#### Core

- **Core**: Disable analytics in stream module to avoid unnecessary error logs.
 [#8798](https://github.com/Kong/kong-ee/issues/8798)
 [FTI-5845](https://konghq.atlassian.net/browse/FTI-5845)

- Fix a problem that a new DP cannot resolve the license required Vault reference after the first configuration push.
 [#8357](https://github.com/Kong/kong-ee/issues/8357)
 [FTI-5733](https://konghq.atlassian.net/browse/FTI-5733)

- Fixed an issue where DP was unable to resolve license required Vault reference when loading an existing lmdb.
 [#8778](https://github.com/Kong/kong-ee/issues/8778)
 [FTI-5875](https://konghq.atlassian.net/browse/FTI-5875)

- Fixing an issue where users were not allowed to start Kong Gateway if `admin_gui_auth_conf.scope` is missing `"openid"` or `"offline_access"` when `admin_gui_auth` is set to `openid-connect`. Kong Gateway will now print warning logs only if `"openid"` is missing from `admin_gui_auth_conf.scope`.
 [#8551](https://github.com/Kong/kong-ee/issues/8551)
 [KAG-4074](https://konghq.atlassian.net/browse/KAG-4074) [FTI-5831](https://konghq.atlassian.net/browse/FTI-5831)
#### Plugin

- **DegraphQL**: Fixed an issue where GraphQL variables were not being correctly parsed and coerced into their defined types.
 [#8509](https://github.com/Kong/kong-ee/issues/8509)
 [FTI-5815](https://konghq.atlassian.net/browse/FTI-5815)

- Degraphql plugin now uses new configure handler to update graphql router with better error handling
 [#7344](https://github.com/Kong/kong-ee/issues/7344)
 [FTI-5356](https://konghq.atlassian.net/browse/FTI-5356)

- **ACME**: fix a bug where the wrong error log is printed, regarding private keys.
 [#7974](https://github.com/Kong/kong-ee/issues/7974)
 [FTI-5719](https://konghq.atlassian.net/browse/FTI-5719)

- **LDAP AUTH Advanced:** fix an issue where if the credential is encoded with no username kong will throw an error and return 500
 [#8104](https://github.com/Kong/kong-ee/issues/8104)
 [FTI-5702](https://konghq.atlassian.net/browse/FTI-5702)

- **LDAP AUTH Advanced:** fix an issue where an exception will be throwed when ldap search fails
 [#8497](https://github.com/Kong/kong-ee/issues/8497)
 [FTI-5826](https://konghq.atlassian.net/browse/FTI-5826)

- **OAS Validation**, **WebSocket Size Limit**, **WebSocket Validator**, **XML Threat Protection**:
priorities have been updated to prevent collisions between plugins.
The relative priority (and the order of execution) of bundled plugins remained unchanged.
 [#8463](https://github.com/Kong/kong-ee/issues/8463)
 [KAG-3914](https://konghq.atlassian.net/browse/KAG-3914)

- **Rate Limiting Advanced:** Refactored `kong/tools/public/rate-limiting` to keep the original interfaces unchanged (backward compatibility) and extend a new interface `new_instance` to provide isolation between different plugins. If you are using custom Rate Limiting plugins based on this library, please update the initialization code to the new format like 'local ratelimiting = require("kong.tools.public.rate-limiting").new_instance("custom-plugin-name")'. The old interface will be removed in the upcoming major release.
 [#8913](https://github.com/Kong/kong-ee/issues/8913)
 [FTI-5918](https://konghq.atlassian.net/browse/FTI-5918)

- **Rate Limiting Advanced:** Fixed an issue where RLA and other similar plugins using the `rate-limiting` library, when used together, would interfere with each other and thus fail to synchronize counter data to the central data store
 [#8502](https://github.com/Kong/kong-ee/issues/8502)
 [FTI-5828](https://konghq.atlassian.net/browse/FTI-5828)

- **Rate Limiting Advanced:** Falling back to local strategy if sync_rate = 0 when redis goes down
 [#8294](https://github.com/Kong/kong-ee/issues/8294)
 [FTI-5755](https://konghq.atlassian.net/browse/FTI-5755)

- **Rate Limiting Advanced:** The plugin now creates counter syncing timers when being executed instead of being created to reduce some meaningless error logs
 [#7932](https://github.com/Kong/kong-ee/issues/7932)
 [FTI-5246](https://konghq.atlassian.net/browse/FTI-5246)

- **Rate Limiting Advanced:** Print error log when multiple plugins with the same namespace have different configurations
 [#8043](https://github.com/Kong/kong-ee/issues/8043)
 [FTI-5246](https://konghq.atlassian.net/browse/FTI-5246)

- **Rate Limiting Advanced:** fix an issue where if `sync_rate` is changed from a value greater than `0` to `0`, the namespace will be cleared unexpectedly
 [#7932](https://github.com/Kong/kong-ee/issues/7932)
 [FTI-5246](https://konghq.atlassian.net/browse/FTI-5246)

- **Rate Limiting Advanced:** fix some timer-related issues where the counter syncing timer can't be created or destroyed properly
 [#7932](https://github.com/Kong/kong-ee/issues/7932)
 [FTI-5246](https://konghq.atlassian.net/browse/FTI-5246)
#### Admin API

- The `/<workspace>/admins` endpoint was used to return admins associated with a workspace based on their assigned RBAC roles. It has been fixed to return admins according to the workspace they belong to.
 [#8742](https://github.com/Kong/kong-ee/issues/8742)
 [FTI-5727](https://konghq.atlassian.net/browse/FTI-5727)
#### Clustering

- Adjust clustering compatible check related to AWS Secrets Manager
 [#8418](https://github.com/Kong/kong-ee/issues/8418)
 [FTI-5811](https://konghq.atlassian.net/browse/FTI-5811)

- Adjust clustering compatible check related to HCV kube auth path
 [#8280](https://github.com/Kong/kong-ee/issues/8280)
 [FTI-5697](https://konghq.atlassian.net/browse/FTI-5697)

- Adjusted a clustering compatible check related to Hashicorp Vault Approle authentication.
 [#8330](https://github.com/Kong/kong-ee/issues/8330)
 [FTI-5774](https://konghq.atlassian.net/browse/FTI-5774)

- Fixed a problem where event_hooks were prematurely validated in hybrid mode. The fix delays the validation of event_hooks to the point where event_hooks are emitted.
 [#8639](https://github.com/Kong/kong-ee/issues/8639)
 [FTI-5712](https://konghq.atlassian.net/browse/FTI-5712)
## Kong-Manager-Enterprise







### Fixes
#### Default

- Fixed an issue where the "Add Role" button was visible when authenticating with an IDP. It is now hidden when Kong Manager is set to authenticate with an IDP.
 [#3183](https://github.com/Kong/kong-admin/issues/3183)


- Corrected the documentation link shown on the RBAC user form page.
 [#3372](https://github.com/Kong/kong-admin/issues/3372)

## Kong-Portal







### Fixes
#### Default

- Disabled Safari telephone format detection for portal site
 [#285](https://github.com/Kong/kong-portal-templates/issues/285)
 [FTI-5739](https://konghq.atlassian.net/browse/FTI-5739)

- Fixed an issue where newly registered developers were not showing up when `portal_email_verification` was enabled. Kong Manager now lists these unverified developers under the "Unverified" tab on the developer list page.
 [#3335](https://github.com/Kong/kong-portal-templates/issues/3335)

